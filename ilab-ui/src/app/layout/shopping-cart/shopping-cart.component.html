<div [@routerTransition]>
  <app-page-header [heading]="'Programs'" [icon]="'fa-bar-chart-o'" [breadCrumbs]="breadcrumbs"></app-page-header>

  <main class="page">
    <section class="shopping-cart dark ">
      <div class="container">
        <!-- page Head -->
        <div class="block-heading">
          <h2>{{'I Lab Manufacturing Request'|translate}}</h2>
          <p>{{'Turn your Ideas Into Reality And Change Your Future'|translate}}</p>
        </div>
        <!-- End page Head -->

        <!-- Page Content -->
        <ng-container *ngIf="(items$)?.length!=0 else anonymous">
          <!-- <ng-container> -->
          <div class="content">

            <div class="row ">

              <!-- Cart Items Table -->
              <div class="col-md-12 col-lg-8 light-grey-background">
                <div class="items">

                  <!-- One Item Row -->
                  <div class="product" *ngFor="let entity of items$;let i =index">
                    <div class="row">
                      <div class="col-md-3 service-image">
                        <img class="img-fluid " [src]="appConfig.AWSUrl+entity.service.image">
                      </div>
                      <div class="col-md-9">
                        <div class="info">

                          <div class="row">
                            <div class="col-md-12 text-center">
                              <h5>
                                <a [routerLink]="['/CartItem']"
                                  [queryParams]="{service:entity.service.id}">{{entity.service.name}}</a>
                              </h5>

                            </div>
                          </div>

                          <div class="row">
                            <div class="col-md-6 product-name">
                              <div class="product-name">

                                <div class="product-info">
                                  <!-- <div *ngIf="entity?.estimatedStardDate">{{ 'Start Date' | translate }}: <span
                                      class="value">{{entity.estimatedStardDate |date:'fullDate'}}</span></div>
                                  <div *ngIf="entity?.estimatedEndDate">{{ 'Estimated End Date' | translate }}: <span
                                      class="value">{{entity.estimatedEndDate |date:'fullDate'}}</span></div> -->
                                  <div>{{ 'Price' | translate }}: <span class="value">{{entity.unitPrice}}</span></div>
                                  <div>{{ 'Unite Price' | translate }}: <span
                                      class="value">{{entity.unitPrice|currency:'EGP'}}</span></div>
                                  <div> {{ 'Total Price' | translate }}:<span
                                      class="value">{{entity.unitPrice * entity.quantity}}</span></div>
                                  <div>{{ 'Notes' | translate }}: <span class="value">{{entity.notes}}</span></div>


                                </div>
                              </div>
                            </div>

                            <div class="col-md-4 quantity">
                              <label for="quantity">{{ 'Quantity' | translate }}: </label>
                              <input id="quantity" type="number" min="1" [disabled]="loading"
                                (change)="updateItem(entity, quantity.value)" value="{{entity.quantity}}" #quantity
                                class="form-control quantity-input">
                            </div>

                            <div class="col-md-2 price">
                              <!-- <span>$120</span> -->
                              <button type="button" [disabled]="loading" class="btn btn-outline-danger btn-xs"
                                (click)="delete(entity)">
                                <i class="fa fa-trash" aria-hidden="true"></i>
                              </button>

                            </div>
                          </div>

                          <div class="row" *ngFor="let file of entity.files ;index as j" class="card-form">
                            <div class="form-title">{{ 'Digital Material' | translate }}: <span class="value"><a
                                  [href]="getFileUrl(entity,j)">{{file.asset_name}}</a></span></div>
                            <div class="form-body">
                              <div class="row">
                                <div class="col-md-6">
                                  <div>{{'Height' | translate }}:
                                    <span class="value">{{file.height |titlecase}}</span>
                                    <input type="number" [value]="file.height" class="form-control"  (keyup)="inputNumberChanged(entity,$event,'height')" >
                                  </div>
                                </div>
                                <div class="col-md-6">
                                  <div>{{'Width' | translate }}:
                                    <span class="value">{{file.width |titlecase}}</span>
                                    <input type="number" [value]="file.width" class="form-control" (keyup)="inputNumberChanged(entity,$event,'width')">
                                  </div>
                                </div>
                                <div class="col-md-6">
                                  <div>{{'Material' | translate }}:
                                    <span class="value">{{file.material |titlecase}}</span>
                                    <select class="form-control " [ngModel]="file.material" (change)="selectChange(entity,$event,'material')">
                                      <option *ngFor="let mat of entity.service.materials" [value]="mat" >{{mat}}</option>
                                    </select>
                                  </div>
                                </div>
                                <div class="col-md-6" *ngIf="file.type != undefined">
                                  <div>{{'Type' | translate }}: <span class="value">{{file.type |titlecase}}</span></div>
                                   <select class="form-control " [ngModel]="file.type" (change)="selectChange(entity,$event,'type')">
                                      <option *ngFor="let t of entity.service.types" [value]="t" >{{t}}</option>
                                    </select>
                                </div>
                                <div class="col-md-6" *ngIf="file.thickness != undefined">
                                  <div>{{'Thickness' | translate }}: <span class="value">{{file.thickness |titlecase}}</span></div>
                                   <select class="form-control " [ngModel]="file.thickness" (change)="selectChange(entity,$event,'thickness')">
                                      <option *ngFor="let thick of entity.service.thickness" [value]="thick" >{{thick}}</option>
                                    </select>
                                </div>
                                <div class="col-md-6" *ngIf="file.color != undefined">
                                  <div>{{'Color' | translate }}: <span class="value">{{file.color |titlecase}}</span></div>
                                   <select class="form-control " [ngModel]="file.color" (change)="selectChange(entity,$event,'color')">
                                      <option *ngFor="let c of entity.service.colors" [value]="c" >{{c}}</option>
                                    </select>
                                </div>
                                <div class="col-md-6" *ngIf="file.unit != undefined">
                                  <div>{{'Unit' | translate }}: <span class="value">{{file.unit |titlecase}}</span></div>
                                   <select class="form-control " [ngModel]="file.unit" (change)="selectChange(entity,$event,'unit')">
                                      <option *ngFor="let c of entity.service.units" [value]="c" >{{c}}</option>
                                    </select>
                                </div>
                                <div class="col-md-6" *ngIf="file.processes != undefined">
                                  <div>{{'Processes' | translate }}: </div>
                                  <div *ngIf="!entity.service.processes.multi ; else multiDrop">
                                    <select class="form-control " [ngModel]="file.processes" (change)="selectChange(entity,$event,'processes')">
                                      <option *ngFor="let v of entity.service.processes.values" [value]="v" >{{v}}</option>
                                    </select>
                                  </div>
                                  <ng-template #multiDrop>
                                    <ng-multiselect-dropdown
                                      [settings]="dropdownSettings"
                                      [data]="entity.service.processes.values"
                                      [(ngModel)]="selectedItemsArray[i]"
                                      (onSelect)="onItemSelect(entity,$event,i)"
                                      (onDeSelect)="onItemDeSelect(entity,$event,i)"
                                      (onSelectAll)="onSelectAll(entity,$event)"
                                      (onDeSelectAll)="onDeSelectAll(entity,$event)"
                                    >
                                    </ng-multiselect-dropdown>
                                  </ng-template>
                                </div>
                              </div>

                            </div>
                          </div>
                          <hr>
                        </div>

                      </div>
                    </div>
                  </div>
                  <!-- End One Item Row -->

                </div>
              </div>
              <!-- End Cart Items Table -->

              <!-- Cart Summary & Checkout -->
              <div class="col-md-12 col-lg-4">
                <div class="summary">
                  <h3>{{'Summary' | translate }}:</h3>
                  <div class="summary-item"><span class="text">{{'Total' | translate }}:</span><span
                      class="price">{{subTotal  |currency:'EGP'}}</span></div>
                  <!-- <div class="summary-item"><span class="text">Discount</span><span class="price">$0</span></div>
                            <div class="summary-item"><span class="text">Shipping</span><span class="price">$0</span></div>
                            <div class="summary-item"><span class="text">Total</span><span class="price">$360</span></div> -->
                  <button type="button" class="btn btn-primary btn-lg btn-block"
                    (click)="checkout()">{{ 'Checkout' | translate }}</button>
                    <button type="button" *ngIf="hasAdminRole" class="btn btn-success btn-lg btn-block"
                      (click)="convertToGallery()">{{ 'Convert To Gallery' | translate }}</button>
                </div>
              </div>
              <!-- End Cart Summary & Checkout -->

            </div>
          </div>
        </ng-container>
        <!-- End Page Content -->
        <ng-template #anonymous>
          <div style="text-align: center;">
            {{'please Select Service To Create Your ShoppingCart'|translate}}

          </div>
        </ng-template>

      </div>
    </section>
  </main>
</div>
